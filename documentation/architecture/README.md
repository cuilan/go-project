# ç³»ç»Ÿæ¶æ„è®¾è®¡

## ğŸ—ï¸ æ¶æ„æ¦‚è¿°

æœ¬é¡¹ç›®é‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œéµå¾ªä¾èµ–å€’ç½®åŸåˆ™å’Œé¢å‘æ¥å£ç¼–ç¨‹ç†å¿µï¼Œå®ç°äº†é«˜å†…èšã€ä½è€¦åˆçš„ç³»ç»Ÿæ¶æ„ã€‚

## ğŸ“ æ¶æ„å±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨å±‚ (Application Layer)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   Client    â”‚  â”‚   Server    â”‚  â”‚     TUI     â”‚        â”‚
â”‚  â”‚  (cmd/)     â”‚  â”‚  (cmd/)     â”‚  â”‚   (cmd/)    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æœåŠ¡å±‚ (Service Layer)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ UserService â”‚  â”‚ BookService â”‚  â”‚ OtherServiceâ”‚        â”‚
â”‚  â”‚ (service/)  â”‚  â”‚ (service/)  â”‚  â”‚ (service/)  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ä»“å‚¨å±‚ (Repository Layer)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ IUserRepo   â”‚  â”‚ IBookRepo   â”‚  â”‚ IOtherRepo  â”‚        â”‚
â”‚  â”‚ (repository/â”‚  â”‚ (repository/â”‚  â”‚ (repository/â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ•°æ®è®¿é—®å±‚ (Data Access Layer)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   GORM      â”‚  â”‚  database/  â”‚  â”‚   Other     â”‚        â”‚
â”‚  â”‚ (gorm/)     â”‚  â”‚    sql      â”‚  â”‚   ORM       â”‚        â”‚
â”‚  â”‚             â”‚  â”‚ (gosql/)    â”‚  â”‚             â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  åŸºç¡€è®¾æ–½å±‚ (Infrastructure Layer)           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   MySQL     â”‚  â”‚    Redis    â”‚  â”‚   Config    â”‚        â”‚
â”‚  â”‚ PostgreSQL  â”‚  â”‚   Cache     â”‚  â”‚   Logger    â”‚        â”‚
â”‚  â”‚   SQLite    â”‚  â”‚   Queue     â”‚  â”‚   Module    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ è®¾è®¡åŸåˆ™

### 1. ä¾èµ–å€’ç½®åŸåˆ™ (DIP)

- **é«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¨¡å—**ï¼šåº”ç”¨å±‚å’ŒæœåŠ¡å±‚ä¸ç›´æ¥ä¾èµ–å…·ä½“çš„æ•°æ®è®¿é—®å®ç°
- **æŠ½è±¡ä¸ä¾èµ–ç»†èŠ‚**ï¼šé€šè¿‡æ¥å£å®šä¹‰æ•°æ®è®¿é—®å¥‘çº¦
- **ç»†èŠ‚ä¾èµ–æŠ½è±¡**ï¼šå…·ä½“å®ç°ä¾èµ–æ¥å£å®šä¹‰

```go
// æ¥å£å®šä¹‰ï¼ˆæŠ½è±¡ï¼‰
type IUserRepository interface {
    Create(ctx context.Context, user *models.User) error
    GetByID(ctx context.Context, id int64) (*models.User, error)
    GetByUsername(ctx context.Context, username string) (*models.User, error)
    Delete(ctx context.Context, id int64) error
}

// æœåŠ¡å±‚ä¾èµ–æ¥å£ï¼ˆé«˜å±‚ä¾èµ–æŠ½è±¡ï¼‰
type UserService struct {
    userRepo repository.IUserRepository
}

// å…·ä½“å®ç°ä¾èµ–æ¥å£ï¼ˆç»†èŠ‚ä¾èµ–æŠ½è±¡ï¼‰
type gormUserRepository struct {
    db *gorm.DB
}

func (r *gormUserRepository) Create(ctx context.Context, user *models.User) error {
    return r.db.WithContext(ctx).Create(user).Error
}
```

### 2. å•ä¸€èŒè´£åŸåˆ™ (SRP)

æ¯ä¸ªæ¨¡å—å’Œç±»éƒ½æœ‰æ˜ç¡®çš„å•ä¸€èŒè´£ï¼š

- **Repository**: è´Ÿè´£æ•°æ®è®¿é—®é€»è¾‘
- **Service**: è´Ÿè´£ä¸šåŠ¡é€»è¾‘
- **Module**: è´Ÿè´£æ¨¡å—åˆå§‹åŒ–å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†
- **Config**: è´Ÿè´£é…ç½®ç®¡ç†

### 3. å¼€é—­åŸåˆ™ (OCP)

ç³»ç»Ÿå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼š

```go
// æ·»åŠ æ–°çš„ORMå®ç°æ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç 
type sqlxUserRepository struct {
    db *sqlx.DB
}

func (r *sqlxUserRepository) Create(ctx context.Context, user *models.User) error {
    // æ–°çš„å®ç°
}
```

## ğŸ”§ æ ¸å¿ƒç»„ä»¶

### 1. æ¨¡å—åŒ–ç³»ç»Ÿ

```go
// Module æ¥å£å®šä¹‰
type Module interface {
    Name() string
    Init(v *viper.Viper) error
    Close() error
}

// æ¨¡å—æ³¨å†Œå’Œç®¡ç†
var modules []Module

func Register(m ...Module) {
    for _, module := range m {
        modules = append(modules, module)
    }
}

func InitModules(v *viper.Viper) {
    for _, m := range modules {
        if v.IsSet(m.Name()) {
            m.Init(v)
        }
    }
}
```

### 2. ä¾èµ–æ³¨å…¥å®¹å™¨

```go
// å®¹å™¨ç®¡ç†æ‰€æœ‰ä¾èµ–
type repoContainer struct {
    repoMap map[string]interface{}
    mu      sync.RWMutex
}

// æ³¨å†Œå’Œè·å–ä¾èµ–
func RegisterRepository(name string, repo interface{}) {
    getRepoContainer().register(name, repo)
}

func GetRepository(name string) (interface{}, bool) {
    return getRepoContainer().get(name)
}
```

### 3. é…ç½®é©±åŠ¨

```go
// é…ç½®ç»“æ„ä½“
type GormConfig struct {
    Driver string `mapstructure:"driver"`
    Dsn    string `mapstructure:"dsn"`
    Config struct {
        EnableLogger bool   `mapstructure:"enable_logger"`
        LogLevel     string `mapstructure:"log_level"`
    } `mapstructure:"config"`
}

// æ¡ä»¶åˆå§‹åŒ–
func (m *gormModule) Init(v *viper.Viper) error {
    if !v.IsSet("gorm") {
        return nil // è·³è¿‡åˆå§‹åŒ–
    }
    // è§£æé…ç½®å¹¶åˆå§‹åŒ–
}
```

## ğŸ›ï¸ æ¶æ„æ¨¡å¼

### 1. åˆ†å±‚æ¶æ„ (Layered Architecture)

- **è¡¨ç°å±‚**: cmd/ ç›®å½•ä¸‹çš„åº”ç”¨å…¥å£
- **ä¸šåŠ¡å±‚**: internal/service/ ä¸šåŠ¡é€»è¾‘
- **æ•°æ®è®¿é—®å±‚**: internal/orm/ æ•°æ®è®¿é—®
- **åŸºç¡€è®¾æ–½å±‚**: æ•°æ®åº“ã€ç¼“å­˜ã€é…ç½®ç­‰

### 2. æ¨¡å—åŒ–æ¶æ„ (Modular Architecture)

æ¯ä¸ªåŠŸèƒ½æ¨¡å—éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå¯ä»¥ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•å’Œéƒ¨ç½²ï¼š

```
internal/
â”œâ”€â”€ module/          # æ¨¡å—åŒ–ç³»ç»Ÿ
â”œâ”€â”€ orm/            # æ•°æ®è®¿é—®æ¨¡å—
â”‚   â”œâ”€â”€ gorm/      # GORM å®ç°
â”‚   â”œâ”€â”€ gosql/     # database/sql å®ç°
â”‚   â””â”€â”€ repository/ # ä»“å‚¨æ¥å£
â”œâ”€â”€ rdb/            # Redis æ¨¡å—
â”œâ”€â”€ logger/         # æ—¥å¿—æ¨¡å—
â””â”€â”€ http/           # HTTP æ¨¡å—
```

### 3. ä¾èµ–æ³¨å…¥æ¨¡å¼ (Dependency Injection)

é€šè¿‡å®¹å™¨ç®¡ç†æ‰€æœ‰ä¾èµ–ï¼Œå®ç°æ¾è€¦åˆï¼š

```go
// è‡ªåŠ¨æ³¨å…¥
func autowired(db *gorm.DB) {
    repository.RegisterRepository(repository.UserRepositoryName, NewGormUserRepository(db))
    repository.RegisterRepository(repository.BookRepositoryName, NewGormBookRepository(db))
}

// ä½¿ç”¨ä¾èµ–
func NewUserService() *UserService {
    return &UserService{
        userRepo: repository.GetUserRepository(),
    }
}
```

## ğŸ”„ æ•°æ®æµ

### 1. è¯·æ±‚å¤„ç†æµç¨‹

```
HTTP Request â†’ Router â†’ Middleware â†’ Controller â†’ Service â†’ Repository â†’ Database
```

### 2. é…ç½®åŠ è½½æµç¨‹

```
å¯åŠ¨ â†’ åŠ è½½é…ç½®æ–‡ä»¶ â†’ åˆå§‹åŒ–æ—¥å¿— â†’ æ³¨å†Œæ¨¡å— â†’ æ¡ä»¶åˆå§‹åŒ– â†’ å¯åŠ¨åº”ç”¨
```

### 3. ä¾èµ–æ³¨å…¥æµç¨‹

```
æ¨¡å—æ³¨å†Œ â†’ é…ç½®è§£æ â†’ æ¡ä»¶åˆå§‹åŒ– â†’ ä¾èµ–æ³¨å…¥ â†’ å®¹å™¨ç®¡ç† â†’ æœåŠ¡ä½¿ç”¨
```

## ğŸ¨ è®¾è®¡æ¨¡å¼

### 1. å·¥å‚æ¨¡å¼ (Factory Pattern)

```go
// ä»“å‚¨å·¥å‚
func NewGormUserRepository(db *gorm.DB) repository.IUserRepository {
    return &gormUserRepository{db: db}
}

func NewUserRepository() repository.IUserRepository {
    return &gosqlUserRepository{db: GetDB()}
}
```

### 2. å•ä¾‹æ¨¡å¼ (Singleton Pattern)

```go
// å…¨å±€å®¹å™¨å•ä¾‹
var globalContainer *repoContainer
var once sync.Once

func getRepoContainer() *repoContainer {
    once.Do(func() {
        globalContainer = &repoContainer{
            repoMap: make(map[string]interface{}),
        }
    })
    return globalContainer
}
```

### 3. ç­–ç•¥æ¨¡å¼ (Strategy Pattern)

```go
// ä¸åŒçš„ORMå®ç°ä½œä¸ºç­–ç•¥
type IUserRepository interface {
    Create(ctx context.Context, user *models.User) error
    GetByID(ctx context.Context, id int64) (*models.User, error)
}

// GORM ç­–ç•¥
type gormUserRepository struct{}

// database/sql ç­–ç•¥
type gosqlUserRepository struct{}
```

## ğŸ”’ å®‰å…¨è®¾è®¡

### 1. é…ç½®å®‰å…¨

- æ•æ„Ÿä¿¡æ¯è„±æ•æ˜¾ç¤º
- ç¯å¢ƒå˜é‡æ”¯æŒ
- é…ç½®æ–‡ä»¶æƒé™æ§åˆ¶

### 2. æ•°æ®å®‰å…¨

- å‚æ•°åŒ–æŸ¥è¯¢é˜²æ­¢SQLæ³¨å…¥
- è¿æ¥æ± ç®¡ç†
- äº‹åŠ¡å¤„ç†

### 3. æ—¥å¿—å®‰å…¨

- æ•æ„Ÿä¿¡æ¯è„±æ•
- æ—¥å¿—çº§åˆ«æ§åˆ¶
- æ—¥å¿—è½®è½¬

## ğŸ“ˆ æ‰©å±•æ€§è®¾è®¡

### 1. æ°´å¹³æ‰©å±•

- æ— çŠ¶æ€è®¾è®¡
- é…ç½®å¤–éƒ¨åŒ–
- æœåŠ¡å‘ç°æ”¯æŒ

### 2. å‚ç›´æ‰©å±•

- æ¨¡å—åŒ–è®¾è®¡
- æ¥å£æ ‡å‡†åŒ–
- æ’ä»¶åŒ–æ¶æ„

### 3. åŠŸèƒ½æ‰©å±•

- æ–°ORMå®ç°
- æ–°ä¸šåŠ¡æ¨¡å—
- æ–°å­˜å‚¨å¼•æ“

## ğŸ§ª å¯æµ‹è¯•æ€§

### 1. å•å…ƒæµ‹è¯•

- æ¥å£éš”ç¦»
- Mockæ”¯æŒ
- ä¾èµ–æ³¨å…¥

### 2. é›†æˆæµ‹è¯•

- æ•°æ®åº“æµ‹è¯•
- APIæµ‹è¯•
- ç«¯åˆ°ç«¯æµ‹è¯•

### 3. æ€§èƒ½æµ‹è¯•

- åŸºå‡†æµ‹è¯•
- å‹åŠ›æµ‹è¯•
- ç›‘æ§æŒ‡æ ‡

## ğŸ“Š ç›‘æ§å’Œå¯è§‚æµ‹æ€§

### 1. æ—¥å¿—ç³»ç»Ÿ

- ç»“æ„åŒ–æ—¥å¿—
- æ—¥å¿—çº§åˆ«
- æ—¥å¿—èšåˆ

### 2. æŒ‡æ ‡ç›‘æ§

- æ€§èƒ½æŒ‡æ ‡
- ä¸šåŠ¡æŒ‡æ ‡
- ç³»ç»ŸæŒ‡æ ‡

### 3. é“¾è·¯è¿½è¸ª

- è¯·æ±‚è¿½è¸ª
- ä¾èµ–è¿½è¸ª
- æ€§èƒ½åˆ†æ

---

è¿™ä¸ªæ¶æ„è®¾è®¡ç¡®ä¿äº†ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§å’Œå¯æµ‹è¯•æ€§ï¼Œä¸ºé¡¹ç›®çš„é•¿æœŸå‘å±•å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚ 