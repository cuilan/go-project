# Go é¡¹ç›®æ¨¡æ¿

è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ã€å·¥ç¨‹åŒ–çš„ Go é¡¹ç›®æ¨¡æ¿ï¼Œæ—¨åœ¨ä¸ºæ–°çš„ Go åº”ç”¨æä¾›ä¸€ä¸ªåšå®çš„èµ·ç‚¹ã€‚å®ƒæ•´åˆäº†ç¤¾åŒºæœ€ä½³å®è·µï¼ŒåŒ…æ‹¬é¡¹ç›®å¸ƒå±€ã€è·¨å¹³å°æ„å»ºã€è‡ªåŠ¨åŒ–æµ‹è¯•ã€æ‰“åŒ…åˆ†å‘ä»¥åŠæœåŠ¡éƒ¨ç½²ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- **æ ‡å‡†åŒ–çš„é¡¹ç›®å¸ƒå±€**ï¼šéµå¾ª Go ç¤¾åŒºå¹¿æ³›æ¥å—çš„ [`golang-standards/project-layout`](https://github.com/golang-standards/project-layout) è§„èŒƒã€‚
- **å¼ºå¤§çš„æ„å»ºç³»ç»Ÿ**ï¼šåŸºäº `Makefile` å’Œ Go è„šæœ¬ï¼Œæä¾›ç»Ÿä¸€ã€è·¨å¹³å°çš„å¼€å‘ä½“éªŒã€‚
- **ä¸€é”®å¼è·¨å¹³å°ç¼–è¯‘**ï¼šé€šè¿‡ `make build` è½»æ¾ç¼–è¯‘å‡º `Linux`, `Windows`, `macOS` çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚
- **è‡ªåŠ¨åŒ–æ‰“åŒ…ä¸åˆ†å‘**ï¼šä½¿ç”¨ `make dist` å‘½ä»¤å¯ä¸€é”®ç”ŸæˆåŒ…å«é…ç½®æ–‡ä»¶å’Œå®‰è£…è„šæœ¬çš„ `.zip` åˆ†å‘åŒ…ã€‚
- **å†…ç½®ä»£ç è´¨é‡å·¥å…·**ï¼šé›†æˆäº† `fmt`, `vet`, `staticcheck` ç­‰å·¥å…·ï¼Œé€šè¿‡ `make lint` è¿è¡Œã€‚
- **æµ‹è¯•ä¸è¦†ç›–ç‡æŠ¥å‘Š**ï¼šæ”¯æŒ `make test` å•å…ƒæµ‹è¯•å’Œ `make test-cover` è¦†ç›–ç‡æŠ¥å‘Šç”Ÿæˆã€‚
- **å®Œå–„çš„æœåŠ¡éƒ¨ç½²æ–¹æ¡ˆ**ï¼š
    - **Linux**: æä¾› `systemd` æœåŠ¡å®‰è£…è„šæœ¬ï¼Œæ”¯æŒå¼€æœºè‡ªå¯ã€å®ˆæŠ¤è¿›ç¨‹ã€‚
    - **Windows**: å®ç°åŸç”Ÿ Windows æœåŠ¡ï¼Œå¹¶æä¾›å®‰è£…å’Œå¸è½½è„šæœ¬ã€‚
- **ç‰ˆæœ¬ä¿¡æ¯æ³¨å…¥**ï¼šç¼–è¯‘æ—¶è‡ªåŠ¨å°† Git `tag` å’Œ `commit hash` æ³¨å…¥åˆ°æ–‡ä»¶åä¸­ï¼Œä¾¿äºç‰ˆæœ¬è¿½æº¯ã€‚

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ bin/                      # (æœ¬åœ°å¼€å‘) ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶ (è¢« .gitignore å¿½ç•¥)
â”œâ”€â”€ cmd/                      # é¡¹ç›®ä¸»ç¨‹åºçš„å…¥å£
â”‚   â””â”€â”€ your-app/
â”œâ”€â”€ configs/                  # é…ç½®æ–‡ä»¶æ¨¡æ¿
â”œâ”€â”€ dist/                     # (æ‰“åŒ…åˆ†å‘) ç”Ÿæˆçš„ .zip åˆ†å‘åŒ… (è¢« .gitignore å¿½ç•¥)
â”œâ”€â”€ init/                     # éƒ¨ç½²å’Œåˆå§‹åŒ–è„šæœ¬
â”‚   â”œâ”€â”€ linux/                # systemd (Linux) æœåŠ¡ç›¸å…³è„šæœ¬
â”‚   â””â”€â”€ windows/              # Windows æœåŠ¡ç›¸å…³è„šæœ¬
â”œâ”€â”€ internal/                 # é¡¹ç›®å†…éƒ¨ç§æœ‰ä»£ç 
â”œâ”€â”€ pkg/                      # å¯ä¾›å¤–éƒ¨ä½¿ç”¨çš„å…¬å…±åº“ä»£ç 
â”œâ”€â”€ scripts/                  # å…¶ä»–è¾…åŠ©è„šæœ¬ (å¦‚ï¼šæ—§çš„äº¤å‰ç¼–è¯‘è„šæœ¬)
â”œâ”€â”€ tools/                    # é¡¹ç›®å·¥å…· (å¦‚ï¼šè‡ªå®šä¹‰çš„ Go æ„å»ºè„šæœ¬)
â”œâ”€â”€ .gitignore
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ Makefile                  # é¡¹ç›®è‡ªåŠ¨åŒ–ä»»åŠ¡å…¥å£
â””â”€â”€ README.md
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†æ¨¡æ¿

```bash
git clone https://github.com/your-repo/go-project.git
cd go-project
```

### 2. (å¯é€‰) å®‰è£…å¼€å‘å·¥å…·

ä¸ºäº†ä½¿ç”¨ `make lint` å‘½ä»¤ï¼Œéœ€è¦å®‰è£… `staticcheck`ã€‚
```bash
make install-tools
```

### 3. æœ¬åœ°æ„å»º

åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä¸­ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶ã€‚äº§ç‰©å°†ä½äº `bin/` ç›®å½•ä¸‹ã€‚
```bash
make build
```

### 4. è¿è¡Œæµ‹è¯•ä¸æ£€æŸ¥

åœ¨æäº¤ä»£ç å‰ï¼Œç¡®ä¿æ‰€æœ‰æ£€æŸ¥éƒ½é€šè¿‡ã€‚
```bash
# è¿è¡Œæ‰€æœ‰ä»£ç æ£€æŸ¥å™¨
make lint

# è¿è¡Œå•å…ƒæµ‹è¯•
make test

# ç”Ÿæˆä»£ç è¦†ç›–ç‡æŠ¥å‘Š (ç”Ÿæˆ coverage.html)
make test-cover
```

### 5. æ‰“åŒ…ç”¨äºåˆ†å‘

å½“æ‚¨å‡†å¤‡å‘å¸ƒä¸€ä¸ªæ–°ç‰ˆæœ¬æ—¶ï¼Œä½¿ç”¨æ­¤å‘½ä»¤ã€‚å®ƒä¼šç”ŸæˆåŒ…å«æ‰€æœ‰å¿…è¦æ–‡ä»¶çš„ `.zip` åŒ…ï¼Œå¹¶å­˜æ”¾åœ¨ `dist/` ç›®å½•ä¸‹ã€‚
```bash
make dist
```
æ‰“åŒ…å‰ï¼Œå»ºè®®æ‚¨å…ˆåœ¨æœ¬åœ°æ‰“ä¸€ä¸ª `git tag`ï¼Œä¾‹å¦‚ `git tag v1.0.0`ï¼Œè¿™æ ·ç‰ˆæœ¬å·å°±èƒ½æ­£ç¡®åœ°åµŒå…¥åˆ°åŒ…åä¸­ã€‚

## ğŸ› ï¸ Makefile å‘½ä»¤è¯¦è§£

### é€šç”¨å‘½ä»¤ï¼ˆé€‚ç”¨äºæ‰€æœ‰å¹³å°ï¼‰

- `make all`: é»˜è®¤ç›®æ ‡ï¼Œç­‰åŒäº `make build`ã€‚
- `make build`: ä¸ºæ‰€æœ‰åœ¨ `PLATFORMS` å˜é‡ä¸­å®šä¹‰çš„ç›®æ ‡å¹³å°è¿›è¡Œäº¤å‰ç¼–è¯‘ã€‚
- `make dist`: æ„å»ºå¹¶ä¸ºæ¯ä¸ªå¹³å°æ‰“åŒ…æˆä¸€ä¸ªå¯åˆ†å‘çš„ `.zip` æ–‡ä»¶ã€‚
- `make lint`: è¿è¡Œä»£ç æ ¼å¼åŒ–ã€`go vet` å’Œ `staticcheck`ã€‚
- `make test`: è¿è¡Œé¡¹ç›®ä¸­çš„æ‰€æœ‰å•å…ƒæµ‹è¯•ã€‚
- `make test-cover`: è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆ HTML æ ¼å¼çš„ä»£ç è¦†ç›–ç‡æŠ¥å‘Šã€‚
- `make clean`: æ¸…ç†æ‰€æœ‰æ„å»ºäº§ç‰© (`bin/`, `dist/`) å’Œä¸´æ—¶æ–‡ä»¶ã€‚
- `make vendor`: æ•´ç† `go.mod` å¹¶æ›´æ–° `vendor` ç›®å½•ã€‚
- `make mod-tidy`: ä»…æ•´ç† `go.mod` æ–‡ä»¶ã€‚
- `make mod-download`: ä¸‹è½½ä¾èµ–åˆ°æœ¬åœ°æ¨¡å—ç¼“å­˜ã€‚
- `make install-tools`: å®‰è£…é¡¹ç›®ä¾èµ–çš„å¼€å‘å·¥å…·ã€‚
- `make help`: æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨çš„ `make` å‘½ä»¤åŠå…¶è¯´æ˜ã€‚

### Windows ç‰¹å®šå‘½ä»¤

åœ¨ Windows ç¯å¢ƒä¸‹ï¼Œå»ºè®®ä½¿ç”¨ `Makefile.windows`ï¼š

```cmd
# åŸºæœ¬æ„å»ºå‘½ä»¤
make -f Makefile.windows build
make -f Makefile.windows build-all
make -f Makefile.windows dist

# Windows æœåŠ¡ç®¡ç†
make -f Makefile.windows install-service
make -f Makefile.windows start-service
make -f Makefile.windows stop-service
make -f Makefile.windows restart-service
make -f Makefile.windows uninstall-service

# æˆ–ä½¿ç”¨æ‰¹å¤„ç†æ–‡ä»¶
make-windows.bat build
make-windows.bat install-service
```

è¯¦ç»†è¯´æ˜è¯·å‚è€ƒ [Windows å¹³å°æ„å»ºæŒ‡å—](README-Windows.md)ã€‚

## éƒ¨ç½²æŒ‡å—

### Linux (Systemd)

1.  å°†å¯¹åº”å¹³å°çš„ `.zip` åŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨å¹¶è§£å‹ã€‚
2.  è¿›å…¥è§£å‹åçš„ `release/init/linux` ç›®å½•ã€‚
3.  **é‡è¦**: ä¿®æ”¹ `install.sh` è„šæœ¬é¡¶éƒ¨çš„ `USER` å’Œ `GROUP` å˜é‡ï¼Œä¸ºæ‚¨å¸Œæœ›ç”¨æ¥è¿è¡ŒæœåŠ¡çš„ç”¨æˆ·ã€‚
4.  ä»¥ `root` æƒé™è¿è¡Œå®‰è£…è„šæœ¬ï¼š
    ```bash
    sudo ./install.sh
    ```
5.  è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆç”¨æˆ·åˆ›å»ºã€æ–‡ä»¶å¤åˆ¶ã€æœåŠ¡æ³¨å†Œå’Œå¯åŠ¨çš„æ‰€æœ‰å·¥ä½œã€‚
6.  ä½¿ç”¨ `systemctl status your-go-project.service` æ£€æŸ¥æœåŠ¡çŠ¶æ€ã€‚

### Windows (æœåŠ¡)

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ Makefile.windowsï¼ˆæ¨èï¼‰

1. åœ¨ Windows ç¯å¢ƒä¸‹ï¼Œä½¿ç”¨ä¸“é—¨çš„ `Makefile.windows` è¿›è¡Œæ„å»ºï¼š
   ```cmd
   # æ„å»º Windows äºŒè¿›åˆ¶æ–‡ä»¶
   make -f Makefile.windows build
   
   # å®‰è£… Windows æœåŠ¡ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰
   make -f Makefile.windows install-service
   
   # ç®¡ç†æœåŠ¡
   make -f Makefile.windows start-service
   make -f Makefile.windows stop-service
   make -f Makefile.windows restart-service
   make -f Makefile.windows uninstall-service
   ```

2. æˆ–è€…ä½¿ç”¨æä¾›çš„æ‰¹å¤„ç†æ–‡ä»¶ï¼š
   ```cmd
   make-windows.bat build
   make-windows.bat install-service
   ```

3. è¯¦ç»†è¯´æ˜è¯·å‚è€ƒ [Windows å¹³å°æ„å»ºæŒ‡å—](README-Windows.md)ã€‚

#### æ–¹æ³•äºŒï¼šä½¿ç”¨ä¼ ç»Ÿæ–¹å¼

1.  å°†å¯¹åº” Windows å¹³å°çš„ `.zip` åŒ…è§£å‹ã€‚
2.  è¿›å…¥è§£å‹åçš„ `release/init/windows` ç›®å½•ã€‚
3.  **ä»¥ç®¡ç†å‘˜èº«ä»½**è¿è¡Œ `install-service.bat`ã€‚
4.  è„šæœ¬ä¼šè‡ªåŠ¨æ³¨å†Œå¹¶å¯åŠ¨æœåŠ¡ã€‚
5.  æ‚¨å¯ä»¥åœ¨ Windows çš„"æœåŠ¡"ç®¡ç†å•å…ƒä¸­æ‰¾åˆ°å¹¶ç®¡ç†æ­¤æœåŠ¡ã€‚å¸è½½æœåŠ¡æ—¶ï¼ŒåŒæ ·ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ `uninstall-service.bat`ã€‚
